{"version":3,"file":"commonHelpers.js","sources":["../src/js/spinner-options.js","../src/js/pixabay-service.js","../src/main.js"],"sourcesContent":["'use strict';\n\n\nexport const spinnerOptions = {\n    lines: 13,\n    length: 38,\n    width: 17,\n    radius: 45,\n    scale: 1,\n    corners: 1,\n    color: '#000',\n    fadeColor: 'transparent',\n    speed: 1,\n    rotate: 0,\n    animation: 'spinner-line-fade-quick',\n    direction: 1,\n    zIndex: 2e9,\n    className: 'spinner',\n    top: '50%',\n    left: '50%',\n    shadow: '0 0 1px transparent',\n    position: 'absolute',\n  };","'use strict';\nimport axios from 'axios';\n\nconst API_KEY = '44510981-dcecc8b47662a7959e520ee44';\nconst BASE_URL = 'https://pixabay.com/api/';\nconst MAX_KEYWORD_LENGTH = 100;\n\nasync function getImagesByKeyword(searchString, page = 1, per_page = 40) {\n  if (searchString.length > MAX_KEYWORD_LENGTH) {\n    throw new Error('Keyword is too long');\n  }\n\n  if (!searchString) {\n    throw new Error('Keyword is required');\n  }\n\n  const keywords = searchString.split(/\\s+/);\n  const searchQuery = keywords.join('+');\n\n  const { data } = await axios(\n    `${BASE_URL}?key=${API_KEY}&q=${searchQuery}&image_type=photo&orientation=horizontal&safesearch=true&page=${page}&per_page=${per_page}`\n  );\n  \n  return data;\n}\n\nexport { getImagesByKeyword };\n","'use strict';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport { Spinner } from 'spin.js';\nimport { spinnerOptions } from './js/spinner-options';\nimport { getImagesByKeyword as getImagesByKeywords } from './js/pixabay-service';\n\nconst elements = {\n  gallery: document.querySelector('.gallery'),\n  form: document.querySelector('#search-form'),\n  loader: document.getElementById('loader'),\n  spinner: new Spinner(spinnerOptions),\n  lightbox: new SimpleLightbox('.gallery a', {}),\n  contentLoader: document.getElementById('content-loader'),\n  submitBtn: document.querySelector('button[type=\"submit\"]'),\n};\n\nelements.form.addEventListener('submit', onSearch);\n\nconst gallery = {\n  next_page: 1,\n  per_page: 40,\n  query: '',\n  max_size: 0,\n  loadedImages: 0,\n};\n\nconst observerOptions = {\n  root: null,\n  rootMargin: '0px 0px 300px 0px',\n  threshold: 1.0,\n};\n\nconst observer = new IntersectionObserver((entries, observer) => {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      if(gallery.loadedImages < gallery.max_size) {\n        loadImages().then(({hits: images}) => {\n          renderImages(images);\n        });\n      }\n      if (gallery.loadedImages >= gallery.max_size) {\n        observer.unobserve(elements.contentLoader); // stop observing if max size reached\n        iziToast.info({\n          message: \"We're sorry, but you've reached the end of search results.\",\n          position: 'topRight',\n        });\n      }\n    }\n  });\n}, observerOptions);\n\nasync function onSearch(event) {\n  event.preventDefault();\n  elements.gallery.innerHTML = ''; // reset gallery content\n  observer.unobserve(elements.contentLoader); // stop observing if new search request to prevent double loading\n  gallery.next_page = 1;\n  gallery.query = elements.form.elements.searchQuery.value.trim();\n  gallery.loadedImages = 0; // reset loaded images count\n\n  try {\n    elements.spinner.spin(elements.loader);\n    elements.submitBtn.setAttribute('disabled', 'disabled');\n    const { hits: images, totalHits } = await loadImages();\n    if (totalHits === 0) {\n      showError(\n        'Sorry, there are no images matching your search query. Please try again.'\n      );\n    } else {\n      gallery.max_size = totalHits;\n      renderImages(images);\n      iziToast.success({\n        title: 'Success',\n        message: `Hooray! We found ${totalHits} images.`,\n        position: 'topRight',\n      });\n      observer.observe(elements.contentLoader);\n    }\n  } catch (error) {\n    showError(error.message);\n  } finally {\n    elements.spinner.stop();\n    elements.submitBtn.removeAttribute('disabled');\n    elements.form.reset();\n  }\n}\n\nfunction showError(message) {\n  iziToast.error({\n    message: message,\n    position: 'topRight',\n  });\n}\n\nasync function loadImages(\n  searchQuery = gallery.query,\n  page = gallery.next_page,\n  per_page = gallery.per_page\n) {\n  elements.spinner.spin(elements.gallery);\n  elements.submitBtn.setAttribute('disabled', 'disabled');\n\n  try {\n    const data  = await getImagesByKeywords(searchQuery, page, per_page);\n    gallery.next_page += 1;\n    gallery.loadedImages += data.hits.length; // update loaded images count\n    return data;\n  } catch (error) {\n    if (gallery.next_page == 1) {\n      // when the first call failed, we expect onSearch() to handle it\n      throw new Error(error);\n    } else {\n      // when any subsequent call failed, we handle the error ourselves\n      showError(error.message);\n    }\n  } finally {\n    elements.spinner.stop();\n    elements.submitBtn.removeAttribute('disabled');\n  }\n}\n\nfunction renderImages(images) {\n  let galleryContainer = document.querySelector('.gallery-container');\n\n  // creating gallery container if it doesn't exist\n  if (!galleryContainer) {\n    galleryContainer = document.createElement('ul');\n    galleryContainer.classList.add('gallery-container');\n    elements.gallery.appendChild(galleryContainer);\n  }\n\n  // adjust scroll position for the first page\n  if (gallery.next_page == 2) {\n    adjustScrollPosition();\n  }\n\n  const photoCards = images\n    .map(image => {\n      return `<a href=\"${image.largeImageURL}\">\n        <div class=\"photo-card\">\n        <img src=\"${image.webformatURL}\" alt=\"${image.tags}\" loading=\"lazy\"/>\n        <div class=\"info\">\n        <p class=\"info-item\">\n        <b>Likes</b>\n        ${image.likes}\n        </p>\n        <p class=\"info-item\">\n        <b>Views</b>\n        ${image.views}\n        </p>\n        <p class=\"info-item\">\n        <b>Comments</b>\n        ${image.comments}\n        </p>\n        <p class=\"info-item\">\n        <b>Downloads</b>\n        ${image.downloads}\n        </p>\n        </div>\n        </div>\n        </a>`;\n    })\n    .map(card => `<li class=\"gallery-item\">${card}</li>`)\n    .join('');\n  galleryContainer.insertAdjacentHTML('beforeend', photoCards);\n  elements.lightbox.refresh();\n}\n\nfunction adjustScrollPosition() {\n  const { height: cardHeight } = document\n    .querySelector('.gallery')\n    .firstElementChild.getBoundingClientRect();\n\n  window.scrollBy({\n    top: cardHeight * 2,\n    behavior: 'smooth',\n  });\n}\n"],"names":["spinnerOptions","API_KEY","BASE_URL","MAX_KEYWORD_LENGTH","getImagesByKeyword","searchString","page","per_page","searchQuery","data","axios","elements","Spinner","SimpleLightbox","onSearch","gallery","observerOptions","observer","entries","entry","loadImages","images","renderImages","iziToast","event","totalHits","showError","error","message","getImagesByKeywords","galleryContainer","adjustScrollPosition","photoCards","image","card","cardHeight"],"mappings":"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"}